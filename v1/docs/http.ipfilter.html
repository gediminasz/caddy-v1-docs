

<!DOCTYPE html>
<head>
	<head>
		<title>http.ipfilter - Caddy User Guide</title>
		<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Archivo+Black|Source+Sans+Pro:200,300,400,400i,600,700,700i,900">
<link rel="icon" href="/v1/resources/images/favicon.png">
<link rel="stylesheet" href="/v1/resources/css/common.css">
<link rel="stylesheet" href="/v1/resources/css/sweetalert2.min.css">
<script src="/v1/resources/js/sweetalert2.min.js"></script>
<script src="/v1/resources/js/jquery-3.3.1.min.js"></script>
<script src="/v1/resources/js/common.js"></script>
		<link rel="stylesheet" href="/v1/resources/css/docs.css">
	</head>
	<body>
		<header>
	<div class="top-bar content">
	<div class="left-links">
		<a href="/"><img src="/v1/resources/images/caddy-white.png" id="logo" alt="Caddy"></a>
	</div>
	<nav class="right-links links">
		<a href="/v1/download">Download</a>
		<a href="/v1/docs">Docs</a>
		<a href="/v1/stats">Stats</a>
		<a href="https://caddy.community">Forum</a>
		<a href="https://github.com/caddyserver/caddy" id="top-github-link">GitHub</a>
		<a href="/v1/account/login">Log In</a>
	</nav>
</div>
<a href="/" id="v2-banner">
	This page is about Caddy 1 and will go away soon because Caddy 2 is now available. Click here for Caddy 2.
</a>
	<div class="content">
		<h1>User Guide</h1>
	</div>
</header>

<nav class="main">
	<div class="content">
		<a href="/v1/docs" class="current">Documentation</a>
		<a href="/v1/tutorial">Tutorials</a>
		<a href="https://github.com/caddyserver/examples" class="external-link">Examples</a>
	</div>
</nav>


		<div class="content-container">
			<nav class="side">
	<!-- TODO: Consider using Maven Pro or Muli as font... -->
	<h3>Using Caddy</h3>
	<ul>
		<li><a href="/v1/tutorial">Getting Started &rarr;</a></li>
		<li><a href="/v1/docs/cli">Command Line Interface</a></li>
		<li><a href="/v1/docs/caddyfile">Caddyfile Syntax</a></li>
		<li><a href="/v1/docs/telemetry">Telemetry</a></li>
	</ul>

	<h3>HTTP Server</h3>
	<ul>
		<li><a href="/v1/docs/http-caddyfile">HTTP Caddyfile</a></li>
		<li><a href="/v1/docs/automatic-https">Automatic HTTPS</a></li>
		<li><a href="/v1/docs/mitm-detection">MITM Detection</a></li>
		<li><a href="/v1/docs/placeholders">Placeholders</a></li>
		<li><a href="/v1/docs/template-actions">Template Actions</a></li>
	</ul>

	<h4>Standard HTTP Directives</h4>
	<ul>
		<li><a href="/v1/docs/basicauth">basicauth</a></li>
		<li><a href="/v1/docs/bind">bind</a></li>
		<li><a href="/v1/docs/browse">browse</a></li>
		<li><a href="/v1/docs/errors">errors</a></li>
		<li><a href="/v1/docs/expvar">expvar</a></li>
		<li><a href="/v1/docs/ext">ext</a></li>
		<li><a href="/v1/docs/fastcgi">fastcgi</a></li>
		<li><a href="/v1/docs/gzip">gzip</a></li>
		<li><a href="/v1/docs/header">header</a></li>
		<li><a href="/v1/docs/import">import</a></li>
		<li><a href="/v1/docs/index">index</a></li>
		<li><a href="/v1/docs/internal">internal</a></li>
		<li><a href="/v1/docs/limits">limits</a></li>
		<li><a href="/v1/docs/log">log</a></li>
		<li><a href="/v1/docs/markdown">markdown</a></li>
		<li><a href="/v1/docs/mime">mime</a></li>
		<li><a href="/v1/docs/on">on</a></li>
		<li><a href="/v1/docs/pprof">pprof</a></li>
		<li><a href="/v1/docs/proxy">proxy</a></li>
		<li><a href="/v1/docs/push">push</a></li>
		<li><a href="/v1/docs/redir">redir</a></li>
		<li><a href="/v1/docs/request_id">request_id</a></li>
		<li><a href="/v1/docs/rewrite">rewrite</a></li>
		<li><a href="/v1/docs/root">root</a></li>
		<li><a href="/v1/docs/status">status</a></li>
		<li><a href="/v1/docs/templates">templates</a></li>
		<li><a href="/v1/docs/timeouts">timeouts</a></li>
		<li><a href="/v1/docs/tls">tls</a></li>
		<li><a href="/v1/docs/websocket">websocket</a></li>
	</ul>

	<h3>Plugins</h3>
	<ul>
		<li><a href="https://github.com/caddyserver/caddy/wiki" class="external-link">Writing a Caddy Plugin</a></li>
	</ul>

	
		<h4>Caddyfile Loaders</h4>
		<ul>
				<li><a href="/v1/docs/docker">docker</a></li>
		</ul>
	
		<h4>DNS Providers</h4>
		<ul>
				<li><a href="/v1/docs/tls.dns.auroradns">tls.dns.auroradns</a></li>
				<li><a href="/v1/docs/tls.dns.azure">tls.dns.azure</a></li>
				<li><a href="/v1/docs/tls.dns.cloudflare">tls.dns.cloudflare</a></li>
				<li><a href="/v1/docs/tls.dns.cloudxns">tls.dns.cloudxns</a></li>
				<li><a href="/v1/docs/tls.dns.digitalocean">tls.dns.digitalocean</a></li>
				<li><a href="/v1/docs/tls.dns.dnsimple">tls.dns.dnsimple</a></li>
				<li><a href="/v1/docs/tls.dns.dnsmadeeasy">tls.dns.dnsmadeeasy</a></li>
				<li><a href="/v1/docs/tls.dns.dnspod">tls.dns.dnspod</a></li>
				<li><a href="/v1/docs/tls.dns.duckdns">tls.dns.duckdns</a></li>
				<li><a href="/v1/docs/tls.dns.dyn">tls.dns.dyn</a></li>
				<li><a href="/v1/docs/tls.dns.exoscale">tls.dns.exoscale</a></li>
				<li><a href="/v1/docs/tls.dns.gandi">tls.dns.gandi</a></li>
				<li><a href="/v1/docs/tls.dns.gandiv5">tls.dns.gandiv5</a></li>
				<li><a href="/v1/docs/tls.dns.godaddy">tls.dns.godaddy</a></li>
				<li><a href="/v1/docs/tls.dns.googlecloud">tls.dns.googlecloud</a></li>
				<li><a href="/v1/docs/tls.dns.lightsail">tls.dns.lightsail</a></li>
				<li><a href="/v1/docs/tls.dns.linode">tls.dns.linode</a></li>
				<li><a href="/v1/docs/tls.dns.namecheap">tls.dns.namecheap</a></li>
				<li><a href="/v1/docs/tls.dns.namedotcom">tls.dns.namedotcom</a></li>
				<li><a href="/v1/docs/tls.dns.namesilo">tls.dns.namesilo</a></li>
				<li><a href="/v1/docs/tls.dns.ns1">tls.dns.ns1</a></li>
				<li><a href="/v1/docs/tls.dns.otc">tls.dns.otc</a></li>
				<li><a href="/v1/docs/tls.dns.ovh">tls.dns.ovh</a></li>
				<li><a href="/v1/docs/tls.dns.powerdns">tls.dns.powerdns</a></li>
				<li><a href="/v1/docs/tls.dns.rackspace">tls.dns.rackspace</a></li>
				<li><a href="/v1/docs/tls.dns.rfc2136">tls.dns.rfc2136</a></li>
				<li><a href="/v1/docs/tls.dns.route53">tls.dns.route53</a></li>
				<li><a href="/v1/docs/tls.dns.vultr">tls.dns.vultr</a></li>
		</ul>
	
		<h4>Directives/Middleware</h4>
		<ul>
				<li><a href="/v1/docs/dyndns">dyndns</a></li>
				<li><a href="/v1/docs/http.authz">http.authz</a></li>
				<li><a href="/v1/docs/http.awses">http.awses</a></li>
				<li><a href="/v1/docs/http.awslambda">http.awslambda</a></li>
				<li><a href="/v1/docs/http.cache">http.cache</a></li>
				<li><a href="/v1/docs/http.cgi">http.cgi</a></li>
				<li><a href="/v1/docs/http.cors">http.cors</a></li>
				<li><a href="/v1/docs/http.datadog">http.datadog</a></li>
				<li><a href="/v1/docs/http.expires">http.expires</a></li>
				<li><a href="/v1/docs/http.filter">http.filter</a></li>
				<li><a href="/v1/docs/http.forwardproxy">http.forwardproxy</a></li>
				<li><a href="/v1/docs/http.geoip">http.geoip</a></li>
				<li><a href="/v1/docs/http.git">http.git</a></li>
				<li><a href="/v1/docs/http.gomods">http.gomods</a></li>
				<li><a href="/v1/docs/http.gopkg">http.gopkg</a></li>
				<li><a href="/v1/docs/http.grpc">http.grpc</a></li>
				<li><a href="/v1/docs/http.ipfilter">http.ipfilter</a></li>
				<li><a href="/v1/docs/http.jwt">http.jwt</a></li>
				<li><a href="/v1/docs/http.locale">http.locale</a></li>
				<li><a href="/v1/docs/http.login">http.login</a></li>
				<li><a href="/v1/docs/http.mailout">http.mailout</a></li>
				<li><a href="/v1/docs/http.minify">http.minify</a></li>
				<li><a href="/v1/docs/http.nobots">http.nobots</a></li>
				<li><a href="/v1/docs/http.permission">http.permission</a></li>
				<li><a href="/v1/docs/http.prometheus">http.prometheus</a></li>
				<li><a href="/v1/docs/http.proxyprotocol">http.proxyprotocol</a></li>
				<li><a href="/v1/docs/http.pubsub">http.pubsub</a></li>
				<li><a href="/v1/docs/http.ratelimit">http.ratelimit</a></li>
				<li><a href="/v1/docs/http.realip">http.realip</a></li>
				<li><a href="/v1/docs/http.reauth">http.reauth</a></li>
				<li><a href="/v1/docs/http.recaptcha">http.recaptcha</a></li>
				<li><a href="/v1/docs/http.restic">http.restic</a></li>
				<li><a href="/v1/docs/http.s3browser">http.s3browser</a></li>
				<li><a href="/v1/docs/http.supervisor">http.supervisor</a></li>
				<li><a href="/v1/docs/http.torproxy">http.torproxy</a></li>
				<li><a href="/v1/docs/http.webdav">http.webdav</a></li>
				<li><a href="/v1/docs/http.webp">http.webp</a></li>
		</ul>
	
		<h4>Event Hooks</h4>
		<ul>
				<li><a href="/v1/docs/hook.service">hook.service</a></li>
		</ul>
	
		<h4>Server Types</h4>
		<ul>
				<li><a href="/v1/docs/dns">dns</a></li>
				<li><a href="/v1/docs/net">net</a></li>
				<li><a href="/v1/docs/supervisor">supervisor</a></li>
		</ul>
	
		<h4>TLS Clustering</h4>
		<ul>
				<li><a href="/v1/docs/consul">consul</a></li>
				<li><a href="/v1/docs/redis">redis</a></li>
		</ul>
	
	</ul>
</nav>
			<article>
				<h2>http.ipfilter <div class="plugin-tag tooltip-right" data-tooltip="This feature extends Caddy's standard functionality.">Plugin</div></h2>

				<aside class="plugin-message">
					This feature does not come with Caddy by default. To get it, select the <b>http.ipfilter</b> plugin when you <a href="/v1/download">download</a> Caddy.
				</aside>

				<p>The ipfilter directive adds the ability to allow or block requests based on the client&amp;#39;s IP address.</p>


				<p><b><a href="https://github.com/pyed/ipfilter/blob/master/README.md" class="external-link">Full documentation</a></b></p>

				
					<h3>Examples</h3>
					<div class="examples">
						<div class="example">
							<div class="example-title">Filter a specific IP or a CIDR range.</div>
							<code class="block">ipfilter / {
	rule block
	ip 70.1.128.0/19 2001:db8::/122 9.12.20.16
}</code>
							<p><code>caddy</code> will block any clients with IPs that fall into one of these two ranges <code>70.1.128.0/19</code> and <code>2001:db8::/122</code> , or a client that has an IP of <code>9.12.20.16</code> explicitly.</p>

						</div>
						<div class="example">
							<div class="example-title">Filter clients based on specified IPs stored as file names in the </div>
							<code class="block">ipfilter / {
	rule block
	prefix_dir blacklisted
}</code>
							<p><code>caddy</code> will block any client IP that appears as a file name in the
<code>blacklisted</code> directory. A relative pathname is relative to the CWD when
<code>caddy</code> is started. When putting the blacklisted directory in the web
server document tree you should also add an <code>internal</code> directive to
ensure those files are not visible via HTTP GET requests. For example,
<code>internal /blacklisted/</code>. You can also specify an absolute pathname to
locate the blacklist directory outside the document tree.

You can create the file in the root of the blacklist directory. This is
known as using a &amp;#34;flat&amp;#34; namespace. For example, <code>blacklisted/127.0.0.1</code>
or <code>blacklisted/2601:647:4601:fa93:1865:4b6c:d055:3f3</code>. However,
putting thousands of files in a single directory may cause
poor performance of the lookup function. So you can also,
and should, use a &amp;#34;sharded&amp;#34; namespace. This involves creating
the file in a subdirectory based on the first two components
of the address. For example, <code>blacklisted/127/0/127.0.0.1</code> or
<code>blacklisted/2601/647/2601:647:4601:fa93:1865:4b6c:d055:3f3</code>.

Note that you can also whitelist IP addresses using this mechanism by
specifying <code>rule allow</code>. This may be useful when it follows a more general
blocking rule (e.g., by country) and you want to selectively allow some
addresses through but don&amp;#39;t want to hardcode the addresses in the Caddy
config file.

This mechanism is most useful when coupled with automated monitoring of your
web server activity to detect signals that your server is under attack from
malware. All your monitoring software has to do is create a file in the
blacklist directory.

At this time the content of the file is ignored. In the future the contents
will probably be read and exposed as a placeholder variable for use in
conjuction with a template to be filled in via the <code>markdown</code> directive. So
you should consider putting some explanatory text in the file explaining why
the address was blocked.</p>

						</div>
						<div class="example">
							<div class="example-title">Filter clients based on their Country ISO Code</div>
							<code class="block">ipfilter / {
	rule allow
	database /data/GeoLite.mmdb
	country US JP
}</code>
							<p>with that in your <code>Caddyfile</code> caddy will only serve users from the <code>United States</code> or <code>Japan</code>.

filtering with country codes requires a local copy of the Geo database, can be downloaded for free from <a href="https://dev.maxmind.com/geoip/geoip2/geolite2/">MaxMind</a>.</p>

						</div>
						<div class="example">
							<div class="example-title">Define a block page</div>
							<code class="block">ipfilter / {
	rule allow
	blockpage default.html
	ip 55.3.4.20 2e80::20:f8ff:fe31:77cf
}</code>
							<p><code>caddy</code> will serve only these 2 IPs, eveyone else will get <code>default.html</code>.</p>

						</div>
						<div class="example">
							<div class="example-title">Multiple paths</div>
							<code class="block">ipfilter /notglobal /secret {
	rule allow
	ip 84.235.124.4
}</code>
							<p>Only serve <code>84.235.124.4</code> under <code>/notglobal</code> and <code>/secret</code>.</p>

						</div>
						<div class="example">
							<div class="example-title">Multiple blocks</div>
							<code class="block">ipfilter / {
	rule allow
	ip 32.55.3.10
}

ipfilter /webhook {
	rule allow
	ip 192.168.1.0/24
}</code>
							<p>You can use as many <code>ipfilter</code> blocks as you please, the above says: block everyone but <code>32.55.3.10</code>, Unless it falls in <code>192.168.1.0/24</code> and requesting a path in <code>/webhook</code>.</p>

						</div>
						<div class="example">
							<div class="example-title">Syntax</div>
							<code class="block">ipfilter &lt;basepath&gt; {
    rule       &lt;block | allow&gt;
    ip         &lt;addresses or CIDR ranges to block&gt;
    prefix_dir &lt;IP addr directory prefix&gt;
    database   &lt;/path/to/GeoLite2-Country.mmdb&gt;
    country    &lt;ISO two letter country codes&gt;
    blockpage  &lt;blockpage.html&gt;
    strict
}</code>
							<p>You can specify zero or more <code>ipfilter</code> blocks. Each <code>ipfilter</code> block has
to specify at least one <code>ip</code>, <code>prefix_dir</code> or <code>country</code> directive. If no
<code>ipfilter</code> blocks are defined this middleware will allow every request.

* <strong>basepath</strong>: A sequence of URI path prefixes to match for the filter
to be active. You have to specify at least one path prefix. Use <code>/</code> to
match every request. If the request doesn&amp;#39;t match one of these prefixes
the filter is ignored for purposes of determining if the request is
blocked or allowed.

* <strong>rule</strong>: Should the filter <code>block</code> (blacklist) or <code>allow</code> (whitelist)
the addresses. This directive is mandatory. It is an error to use it more
than once per ipfilter block. The <strong>rule</strong> in effect for the last <code>ipfilter</code>
block to match a request determines if it is blocked or allowed.

  Note that if you only have <code>ipfilter</code> blocks that specify <code>rule allow</code>
  then any request which doesn&amp;#39;t match those filters will be implicitly
  blocked.

* <strong>ip</strong>: A sequence of IP adddresses or CIDR ranges to match. For example,
<code>ip 1.2.3.4 192.168.0.0/24</code> This is optional. It can be used more than
once in each <code>ipfilter</code> block rather than enumerating all IPs after a single
<code>ip</code> directive.

* <strong>prefix_dir</strong>: Specifies a directory in which to search for file names
matching the IP address of the request. This is optional. It is an error
to use this more than once per <code>ipfilter</code> block.

  You can specify a relative pathname to place it relative to the Caddy
  server CWD (which should be the content root dir).  When putting the
  blacklisted directory in the web server document tree you should also add
  an <code>internal</code> directive to ensure those files are not visible via HTTP
  GET requests. For example, <code>internal /blacklist/</code>. You can also specify
  an absolute pathname to locate the blacklist directory outside the
  document tree. And the path can include environment vars. For example,
  <code>prefix_dir {$HOME}/etc/www/blacklist</code>.

  You can create the file in the root of the blacklist directory. This is
  known as using a &amp;#34;flat&amp;#34; namespace. For example, <em>blacklist/127.0.0.1</em>
  or <em>blacklist/2601:647:4601:fa93:1865:4b6c:d055:3f3</em>. However,
  putting thousands of files in a single directory may cause
  poor performance of the lookup function. So you can also,
  and should, use a &amp;#34;sharded&amp;#34; namespace. This involves creating
  the file in a subdirectory based on the first two components
  of the address. For example, <em>blacklist/127/0/127.0.0.1</em> or
  <em>blacklist/2601/647/2601:647:4601:fa93:1865:4b6c:d055:3f3</em>.

  <strong>Note:</strong> IPv6 addresses as file names can use
  colons or equal-signs to separate the components; e.g.,
  <em>blacklist/2601/647/2601=647=4601=fa93==3f3</em>. Using equal-signs in
  place of colons in the file name may be necessary on platforms like MS
  Windows which assign special meaning to colons in file names. You have
  to use one or the other; you cannot mix them in the same file name.

  Note that you can also whitelist IP addresses using this mechanism
  by specifying <code>rule allow</code>. This may be useful when it follows a more
  general blocking rule (e.g., by country) and you want to selectively
  allow some addresses through but don&amp;#39;t want to hardcode the addresses
  in the Caddy config file.

  This mechanism is most useful when coupled with automated monitoring of
  your web server activity to detect signals that your server is under
  attack from malware. All your monitoring software has to do is create
  a file in the blacklist directory.

  At this time the content of the file is ignored. In the future the
  contents will probably be read and exposed as a placeholder variable
  for use in conjuction with a template to be filled in via the <code>markdown</code>
  directive. So you should consider putting some explanatory text in the
  file explaining why the address was blocked.

* <strong>database</strong>: Specifies the path to a
<a href="https://dev.maxmind.com/geoip/geoip2/geolite2/">MaxMind</a> database. This
is required if using the <strong>country</strong> directive; otherwise it should
be omitted.

* <strong>country</strong>: A whitespace separated sequence of ISO two letter country
codes to filter. This is optional but if used also requires a <strong>database</strong>
directive. Note that if a country could not be found for the address it
will be the empty string. This can be specified more than once per block
rather than enumerating all countries on a single line.

* <strong>blockpage</strong>: Names the file to be returned if the ipfilter
matches. Note that a <code>http.StatusOK</code> (200) status is returned if the
page is successfully returned to the client. This is optional. If not
specified then a <code>http.StatusForbidden</code> (403) status is returned.


* <strong>strict</strong>: Use this to disallow use of the address in the
<code>X-Forwarded-For</code> request header if any. This is optional and defaults
to false. If true or there is no <code>X-Forwarded-For</code> header use the address
from the request remote address.</p>

						</div>
					</div>
				

				<div class="springboard-header">
					Related Links
				</div>
				<div class="springboard">
					<div class="springboard-point">
						<b>Documentation</b>
						<p>Access the full documentation for this plugin off-site:</p>
						<a href="https://github.com/pyed/ipfilter/blob/master/README.md" class="button external-link">Docs</a>
					</div>
					<div class="springboard-point">
						<b>Plugin Help</b>
						<p>Get help from the maintainers of the http.ipfilter plugin:</p>
						<a href="https://github.com/pyed/ipfilter/issues" class="button external-link">Support</a>
					</div>
					<div class="springboard-point">
						<b>Plugin Website</b>
						<p>Visit http.ipfilter's website for more information:</p>
						<a href="https://github.com/pyed/ipfilter" class="button external-link">Website</a>
					</div>
				</div>

				<div class="plugin-meta">
					<div class="meta-left">
						<b>Plugin Author:</b> Abdulelah
					</div>
					<div class="meta-right">
						<b>Last Updated:</b> 22 Mar 2020, 8:40 PM
					</div>
				</div>

				<div class="plugin-notice">
					This plugin is independent of the Caddy project and is not endorsed or maintained by Caddy developers. Use at your own risk. Do not file issues for this plugin on Caddy's bug tracker.
				</div>

			</article>
		</div>
		<footer>
	<div class="nav-container">
		<div class="flex content">
			<div class="col">
				<img src="/v1/resources/images/caddy-white.png" class="logo" alt="Caddy Web Server">
				<br>
				A project by <a href="https://twitter.com/mholt6">Matthew Holt</a>
				<br>
				as part of <a href="https://www.lightcodelabs.com">Light Code Labs</a>
				<br>
				in partnership with <a href="https://www.ardanlabs.com">Ardan Labs</a>
			</div>
			<nav>
				<h6>The Project</h6>
				<a href="/v1/download">Download</a>
				<a href="https://github.com/caddyserver/caddy">GitHub</a>
				<a href="/v1/docs">Docs</a>
				<a href="/v1/brand">Brand Kit</a>
			</nav>
			<nav>
				<h6>Account</h6>
				<a href="/v1/account/login">Log In</a>
				<a href="/v1/account/register">Sign Up</a>
				<a href="/v1/legal/terms-of-service">Terms of Service</a>
			</nav>
			<nav>
				<h6>Community</h6>
				<a href="https://caddy.community/">Forum</a>
				<a href="https://github.com/caddyserver/caddy">GitHub</a>
				<a href="https://twitter.com/caddyserver">Twitter</a>
				<a href="/v1/blog/">Blog</a>
			</nav>
			<div class="col">
				<h6>Hey, You.</h6>
                Be notified of new releases!
                <form id="footer-signup-form">
                    <input id="footer-email" name="email" type="email" placeholder="> email address" required value="">
                    <button class="subscribe" type="submit">Subscribe</button>
                </form>
			</div>
		</div>
		<div class="copyright">
			&copy; 2015-2020 Light Code Labs. All rights reserved.<br>Caddy&reg; is a registered trademark of Light Code Labs, LLC.
		</div>
	</div>
</footer>

	</body>
</head>